<!DOCTYPE html>
<html>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>FPE SDK Example</title>
<script src="file:///android_asset/floor.js"></script>
<style>
    #hello-plan {
      height: 100%;
    }
    html,
    body {
      height: 100%;
      margin: 0;
      padding: 0;
    }
    .animate {
        stroke-dasharray: 210;
        stroke-dashoffset: 210;
        animation: line-animate 10s forwards infinite;
    }

    @keyframes line-animate {
        to {
            stroke-dasharray: 0;
        }
    }

</style>
<body>
<div id="hello-plan"></div>
<script>
 function loadFpeSdk(floorId, token, devices) {
      const container = document.getElementById('hello-plan')

      const floorPlanStartupSettings = {
            hideElements: ["roomStamp"],
            panZoom: false,
            planRotation: 0,
            roomStampSize: null,
            ui: {
              menu: false,
              scale: false,
              coordinates: false,
            },
            theme: {
              background: {
                color: "#f3f5f8",
                showGrid: false,
              },
              wallContours: false,
              elements: {
                roomstamp: { showArea: false },
                asset: { fill: [255, 255, 255] },
              },
            },
            units: {
              system: "metric",
              digits: 0,
              roomDimensions: "area",
            },
          };

        const floorPlan = new FloorPlanEngine(container, floorPlanStartupSettings)

      const floorDevices = JSON.parse(devices);

      floorPlan.loadScene(floorId, { authorization:token })
      .then(()=>{
        floorDevices.forEach((dev, i) => {
            const svg = createSvg(dev.svg, dev.notification);
             svg.setAttribute("title", dev.id);

             const iconDiv = document.createElement("div");
            iconDiv.appendChild(svg);
            iconDiv.classList.add("draggable");
            iconDiv.setAttribute("draggable", "true");
            iconDiv.setAttribute("title", dev.name);

             const deviceIcon = floorPlan.addHtmlMarker({
                el: iconDiv,
                pos:[+dev.lat, +dev.lng],
            })

            deviceIcon.el.addEventListener('click', (evt) => {
              if (dev.id === evt.target.attributes.title?.value)
                Android.deviceDetailsScreen(dev.id);
            });
         })
        })
  }

   function createSvg(svgPath, alertStatus) {
    var splitPath = svgPath?.split("*");

    const iconSvg = document.createElementNS(
      "http://www.w3.org/2000/svg",
      "svg"
    );
    const iconPath = document.createElementNS(
      "http://www.w3.org/2000/svg",
      "path"
    );
    iconSvg.setAttribute("height", "24");
    iconSvg.setAttribute("width", "24");
    iconSvg.classList.add("draggable");
    if (alertStatus === "Y") {
      iconPath.setAttribute("fill", "none");
      iconPath.setAttribute("stroke", "red");
      iconPath.setAttribute("class", "animate");
      if (splitPath.length > 1) iconPath.setAttribute("d", splitPath[1]);
      else iconPath.setAttribute("d", splitPath[0]);
    } else {
      iconPath.setAttribute("stroke", "blue");
      iconPath.setAttribute("d", splitPath[0]);
    }
    iconSvg.appendChild(iconPath);
    return iconSvg;
  }

window.addEventListener('DOMContentLoaded', loadFpeSdk);


</script>
</body>
</html>